- name: Update status.json and Commit
  run: |
    TIME_NOW=$(date -u +"%Y-%m-%d %H:%M:%S UTC")
    SITE_STATUS="${{ steps.check_site.outputs.STATUS }}"
    
    if [ "$SITE_STATUS" = "200" ]; then
      STATUS="UP"
    else
      STATUS="DOWN"
    fi
    
    # Create valid JSON safely
    cat <<'EOF' > status.json
{
  "url": "'"https://www.cinepolis.com/in"'",
  "status": "'"$STATUS"'",
  "status_code": "'"$SITE_STATUS"'",
  "checked_at": "'"$TIME_NOW"'"
}
EOF

    git config user.name "GitHub Actions"
    git config user.email "actions@github.com"
    
    git add status.json
    
    if git diff --staged --quiet; then
      echo "status.json has no changes. Skipping commit/push."
    else
      git commit -m "Uptime Check: $STATUS ($SITE_STATUS)"
      git push "https://${{ github.actor }}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" HEAD:main
      echo "Successfully committed and pushed status.json."
    fi
