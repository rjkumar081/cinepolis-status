- name: Check Cinepolis Website in Headless Browser
  id: check_site
  run: |
    node <<'EOF'
    const puppeteer = require('puppeteer');

    (async () => {
      let status = 'DOWN';
      let statusCode = '0';
      try {
        const browser = await puppeteer.launch({ 
          headless: true,
          args: ['--no-sandbox', '--disable-setuid-sandbox', '--disable-dev-shm-usage'] 
        });
        const page = await browser.newPage();
        const response = await page.goto('https://www.cinepolis.com/in', { waitUntil: 'networkidle2', timeout: 60000 });
        if (response) {
          statusCode = response.status();
          if (statusCode === 200) status = 'UP';
        }
        await browser.close();
      } catch (err) {
        console.error('Error accessing site:', err.message);
      }

      // write outputs using Environment Files
      const fs = require('fs');
      fs.appendFileSync(process.env.GITHUB_ENV, `STATUS=${status}\n`);
      fs.appendFileSync(process.env.GITHUB_ENV, `STATUS_CODE=${statusCode}\n`);

      // exit 0 so workflow doesn't fail
      process.exit(0);
    })();
    EOF
