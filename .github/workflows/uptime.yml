name: Uptime Check

on:
  schedule:
    - cron: "*/5 * * * *"   # Every 5 minutes
  workflow_dispatch:

jobs:
  uptime:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Check Cinepolis Website
        id: check_site
        run: |
          STATUS_CODE=$(curl -o /dev/null -s -w "%{http_code}" "https://www.cinepolis.com/in")
          echo "STATUS=$STATUS_CODE" >> $GITHUB_OUTPUT

      # ðŸ”´ SEND ALERT IF DOWN
      - name: Send Telegram Alert (DOWN)
        if: steps.check_site.outputs.STATUS != '200'
        run: |
          TOKEN="8126378434:AAEQDXyBmz_lX8cOKLERiN3gBiRio9Zkjm4"
          CHAT_ID="8421770138"
          MSG="ðŸš¨ *Cinepolis Website DOWN!*  
          Status Code: ${{ steps.check_site.outputs.STATUS }}"
          
          curl -s -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
            -d chat_id="$CHAT_ID" \
            -d text="$MSG" \
            -d parse_mode="Markdown"

      # ðŸŸ¢ SEND ALERT IF UP
      - name: Send Telegram Alert (UP)
        if: steps.check_site.outputs.STATUS == '200'
        run: |
          TOKEN="8126378434:AAEQDXyBmz_lX8cOKLERiN3gBiRio9Zkjm4"
          CHAT_ID="8421770138"
          MSG="âœ… Cinepolis Website is UP (200)"

          curl -s -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
            -d chat_id="$CHAT_ID" \
            -d text="$MSG"
