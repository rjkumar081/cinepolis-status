name: Cinepolis Real Browser Monitor

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  monitor:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Node & Puppeteer
        run: |
          npm init -y
          npm install puppeteer fs-extra

      - name: Run Real Browser Check
        run: node scripts/check_status.cjs

      - name: Send Telegram Alert
        run: |
          TOKEN="${{ secrets.TELEGRAM_BOT_TOKEN }}"
          CHAT_ID="${{ secrets.TELEGRAM_CHAT_ID }}"
          if [ "${{ env.STATUS }}" = "UP" ]; then
            MSG="âœ… Cinepolis Website is UP! âœ…%0AURL: https://cinepolis.com/in%0AResponse Time: ${{ env.RESPONSE_TIME }}ms%0AChecked At: ${{ env.CHECKED_AT }}"
          else
            MSG="ðŸš¨ Cinepolis Website is DOWN! ðŸš¨%0AURL: https://cinepolis.com/in%0AResponse Time: ${{ env.RESPONSE_TIME }}ms%0AChecked At: ${{ env.CHECKED_AT }}"
          fi
          curl -s -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
            -d chat_id="$CHAT_ID" \
            --data-urlencode "text=$MSG" \
            -d parse_mode="Markdown"
